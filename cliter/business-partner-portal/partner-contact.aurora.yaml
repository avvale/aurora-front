version: 0.0.1
boundedContextName: business-partner-portal
moduleName: partner-contact
moduleNames: partner-contacts
aggregateName: BusinessPartnerPortalPartnerContact
hasOAuth: true
hasTenant: false
hasAuditing: true
front:
  outlineIcon: mat_outline:contact_page
  solidIcon: mat_solid:contact_page
description: |
  Contact persons associated with business partners. Manages individual contacts within partner organizations, including their roles, contact information, and communication preferences. Each contact belongs to exactly one business partner (many-to-one relationship). Contacts can optionally have portal access credentials via one-to-one relationship with iam/user, enabling them to authenticate and perform operations in the Business Partner Portal. Used for targeted communications, relationship management, and portal access control. Related modules: business-partner (parent entity), iam/user (portal credentials).
aggregateProperties:
  - name: id
    type: id
    primaryKey: true
    nullable: false
    description: |
      Unique identifier for the partner contact. UUID v4 format, generated automatically on creation. Used as primary key for referencing this contact across the system, in communications tracking, and interaction logs.
  - name: rowId
    type: bigint
    index: unique
    autoIncrement: true
    nullable: false
    description: |
      Auto-incrementing sequential identifier for the partner contact. Used for internal ordering, human-readable reference, and optimized queries. Not exposed in external APIs. Provides a stable identifier for database operations.
  - name: businessPartnerId
    type: id
    nullable: false
    index: index
    indexName: bpp_partner_contact_bp_id
    relationship:
      type: many-to-one
      aggregateName: BusinessPartnerPortalBusinessPartner
      modulePath: business-partner-portal/business-partner
      key: id
      field: businessPartner
      avoidConstraint: false
    description: |
      Foreign key reference to the business partner this contact belongs to. Each contact is associated with exactly one partner organization. Required field establishing the many-to-one relationship. Indexed for efficient queries when loading all contacts for a specific partner. Constraint enforced to maintain referential integrity.
  - name: firstName
    type: varchar
    maxLength: 128
    nullable: false
    description: |
      First name (given name) of the contact person. Required for personal identification and communication. Used in email greetings, letters, and personal addressing. Should be the preferred first name used by the contact. Cannot be empty to ensure proper identification.
  - name: lastName
    type: varchar
    maxLength: 128
    nullable: false
    index: index
    description: |
      Last name (family name) of the contact person. Required for personal identification and formal communications. Used in sorting, searching, and formal addressing. Indexed for fast search operations when looking up contacts by last name. Combined with firstName for full name display.
  - name: position
    type: varchar
    maxLength: 128
    nullable: true
    description: |
      Job title or position of the contact within their organization (e.g., "Sales Manager", "CEO", "Technical Lead", "Purchasing Director"). Used to understand the contact's role, authority level, and area of responsibility. NULL indicates position not specified. Helps route communications to appropriate personnel.
  - name: department
    type: varchar
    maxLength: 128
    nullable: true
    description: |
      Department or division where the contact works (e.g., "Sales", "Procurement", "Finance", "Technical Support"). Used to categorize contacts and route inquiries to the correct department. NULL indicates department not specified. Useful for large partner organizations with multiple departments.
  - name: email
    type: varchar
    maxLength: 128
    nullable: false
    index: index
    description: |
      Business email address of the contact person. Required field for direct communication. Must be a valid, active email address. Used for sending notifications, documents, and correspondence. Indexed for fast lookups. Should be unique per contact but not enforced to allow shared departmental emails in some cases.
  - name: phone
    type: varchar
    maxLength: 64
    nullable: true
    description: |
      Landline phone number of the contact with full formatting including country and area codes (e.g., +54 11 4567-8901). Used for display purposes in user-facing interfaces, partner directories, and printed communications. NULL indicates no landline number provided. Works together with phoneCountryPrefix and phoneSanitized to provide complete phone handling.
  - name: phoneCountryPrefix
    type: varchar
    maxLength: 4
    nullable: true
    description: |
      Country calling code for the landline number without the plus sign (e.g., 54 for Argentina, 1 for USA, 34 for Spain). Used to identify the country for call routing and phone number validation rules. NULL when no landline phone is provided. Must be consistent with the country prefix embedded in the phone field.
  - name: phoneSanitized
    type: varchar
    maxLength: 64
    nullable: true
    webComponent:
      isDetailHidden: true
    description: |
      Landline number stripped of all formatting characters, containing only digits (e.g., 541145678901). Used for telephony API integrations, automated dialing systems, and deduplication checks. Hidden from detail views to avoid displaying redundant phone information. NULL when no landline phone is provided. Automatically derived from the phone field during creation or update.
  - name: mobile
    type: varchar
    maxLength: 64
    nullable: true
    description: |
      Mobile phone number of the contact with full formatting including country prefix (e.g., +54 9 11 1234-5678). Used for display purposes in user-facing interfaces and partner directories. Preferred channel for urgent communications and SMS/WhatsApp notifications. NULL indicates no mobile number provided. Works together with mobileCountryPrefix and mobileSanitized to provide complete mobile handling.
  - name: mobileCountryPrefix
    type: varchar
    maxLength: 4
    nullable: true
    description: |
      Country calling code for the mobile number without the plus sign (e.g., 54 for Argentina, 1 for USA, 34 for Spain). Used to identify the country for SMS routing, WhatsApp Business API integration, and mobile number validation rules. NULL when no mobile phone is provided. Must be consistent with the country prefix embedded in the mobile field.
  - name: mobileSanitized
    type: varchar
    maxLength: 64
    nullable: true
    webComponent:
      isDetailHidden: true
    description: |
      Mobile number stripped of all formatting characters, containing only digits (e.g., 5491112345678). Used for SMS gateway integrations, WhatsApp Business API, and deduplication checks. Hidden from detail views to avoid displaying redundant phone information. NULL when no mobile phone is provided. Automatically derived from the mobile field during creation or update.
  - name: isPrincipal
    type: boolean
    nullable: false
    defaultValue: false
    description: |
      Indicates if this is the primary contact for the business partner. Primary contact is the main point of contact and receives general communications by default. Only one contact per partner should be primary. When true, this contact is displayed first and used as default in partner communications. Defaults to false. Required field.
  - name: isActive
    type: boolean
    nullable: false
    defaultValue: true
    description: |
      Indicates whether the contact is currently active. When false, the contact is no longer with the organization or should not be contacted. Inactive contacts are preserved for historical records but not used in active communications. Use instead of hard deletion to maintain audit trail. Required field, defaults to true.
  - name: isUser
    type: boolean
    nullable: false
    defaultValue: false
    description: |
      Indicates whether this contact has portal access credentials. When true, the contact can authenticate to the Business Partner Portal to perform operations like uploading invoices, viewing documents, and managing partner data. The associated user account is referenced via userId. When false, the contact is informational only without system access. Defaults to false. Required field.
  - name: userId
    type: id
    nullable: true
    index: unique
    relationship:
      type: one-to-one
      aggregateName: IamUser
      modulePath: iam/user
      key: id
      field: user
      avoidConstraint: true
    description: |
      Foreign key reference to the IAM user account for portal authentication. One-to-one relationship - each contact can have at most one user account. NULL when isUser is false (contact without portal access). When set, the contact can authenticate using the linked user's credentials. Unique index ensures no two contacts share the same user account. Constraint avoided to prevent circular dependencies across bounded contexts (iam ↔ business-partner-portal).
    webComponent:
      type: select
  - name: langId
    type: id
    nullable: true
    index: index
    relationship:
      type: many-to-one
      aggregateName: CommonLang
      modulePath: common/lang
      key: id
      field: lang
      avoidConstraint: true
    description: |
      Foreign key reference to the preferred language of the contact (common/lang module). Many-to-one relationship - multiple contacts can share the same language preference. Used to determine the language for portal UI localization, email templates, document generation, and all communications addressed to this contact. NULL indicates no language preference specified, in which case the system defaults to the partner organization's language or the platform default. Constraint avoided to prevent cross-bounded-context dependencies (common ↔ business-partner-portal).
  - name: notes
    type: text
    nullable: true
    description: |
      Free-text field for additional notes about the contact. Can include preferences, communication tips, relationship history, or any other relevant observations. NULL indicates no notes. Examples: "Prefers morning calls", "Decision maker for technical purchases", "On vacation until [date]". Not used for structured data or business logic.
  - name: createdAt
    type: timestamp
    nullable: true
    description: |
      Timestamp when the contact record was created. Automatically set on record creation. Part of the audit trail for tracking contact management history and relationship development. Used for reporting on contact acquisition patterns.
  - name: updatedAt
    type: timestamp
    nullable: true
    description: |
      Timestamp of the last modification to this contact record. Automatically updated on any field change. Used for tracking contact data evolution, cache invalidation, and audit compliance. Important for monitoring data quality and identifying outdated contact information.
  - name: deletedAt
    type: timestamp
    nullable: true
    description: |
      Soft delete timestamp. NULL indicates an active contact. When set, the contact is hidden from normal queries but preserved for audit purposes and historical communication records. Deleted contacts cannot be used in new communications but existing interaction history remains accessible. Used for compliance with data retention policies while maintaining referential integrity.
excludedOperations:
  - count
  - createBatch
  - delete
  - getRaw
  - max
  - min
  - rawSql
  - sum
  - update
  - updateAndIncrement
  - upsert
